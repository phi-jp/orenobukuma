// # item
item
  div.z-depth-2.item
    div.row
      div.col.s4.side
        div.image
          a(href='{url}', target='_blank')
            // img(src='http://s.wordpress.com/mshots/v1/{url}?w=320')
            img(src='http://capture.heartrails.com/320x240/delay=2?{url}')

      div.col.s8.content
        div.main
          a.title.grey-text.text-darken-4(href='{url}') {title}
          div(if='{!editing}')
            div.markdown(name='_markdown')
          div(if='{editing}')
            textarea.materialize-textarea(name='_description') {note}
        div.action.right-align
          div(if='{!editing}')
            i.material-icons(onclick='{this.edit}') edit
          div(if='{editing}')
            i.material-icons(onclick='{this.save}') save

  style(scoped, type='less').

    .item {
      background-color: white;

      .side {
        height: auto;
        .image {
          border-right: 1px solid rgba(0, 0, 0, 0.1);
          border-bottom: 1px solid rgba(0, 0, 0, 0.1);
          img {
            width: 100%;
          }
        }
      }

      .content {
        position: relative;
        .main {
          padding-top: 1rem;
          padding-right: 1rem;
          .title {
            font-size: 1.4rem;
          }

          .markdown {
            line-height: 1.2;
            ul {
              padding-left: 1.5rem;
              li {
                list-style-type: circle;
              }
            }
          }
        }
        .action {
          cursor: pointer;
          position: absolute;
          right: 16px;
          top: 6px;
          opacity: 0;
          transition: 256ms;
        }
      }

      &:hover {
        .action {
          opacity: 1;
        }
      }
    }
  script.
    this.editing = false;
    this.edit = function() {
      this.editing = true;
      setTimeout(function() {
        this._description.select();
        this._description.value = this._description.value;
        //- this._description.focus();
      }.bind(this));
    };
    this.save = function() {
      var linkRef = ref.child('users').child(authData.uid).child('links').child(this.id);

      linkRef.update({
        note: this._description.value,
      });

      this.editing = false;
    };
    this.del = function() {
      var users = ref.child('links').child(this.id).child('users');
      users.child(authData.uid).remove();

      ref.child('users').child(authData.uid).child('links').child(this.id).remove();
    };

    this.on('update', function() {
      if (this.note) {
        this._markdown.innerHTML = marked(this.note);
      }
    });
